# Verum Omnis PDF Layout Standards

## Overview

This document describes the mandatory PDF layout ruleset for all PDF outputs generated by the Verum Omnis repository. These standards ensure forensic integrity, court admissibility, and professional presentation.

## Page Specifications

### Page Size
- **Format**: A4 Portrait
- **Dimensions**: 210mm × 297mm (8.27" × 11.69")

### Margins
All PDF documents must maintain these minimum margins:

- **Top**: 25mm
- **Left**: 20mm
- **Right**: 20mm
- **Bottom**: 30mm (extra space reserved for QR zone)

## Reserved QR Code Zone

### Purpose
The QR code zone is reserved on every page for cryptographic verification and forensic chain-of-custody tracking.

### Specifications
- **Position**: Bottom-right corner of every page
- **Size**: 45mm × 45mm
- **Padding**: 5mm clear space around the QR code

### Positioning
- **X Position**: `210mm - 20mm (right margin) - 45mm = 145mm`
- **Y Position**: `297mm - 30mm (bottom margin) - 45mm = 222mm`

### Behavior
- **No Overlap**: Text, images, tables, or any other content MUST NOT overlap with this zone
- **Automatic Wrapping**: Content must automatically wrap or break to a new page when approaching this zone
- **Last to Render**: QR codes MUST be rendered last to ensure they are never overwritten

## Safe Text Area

### Calculation
The safe text area is the region where content can be placed without risk of clipping or collision with the QR code zone.

```
Safe Area:
  X: 20mm (left margin)
  Y: 25mm (top margin)
  Width: 170mm (210mm - 20mm left - 20mm right)
  Max Height: 217mm (before QR zone starts at 222mm minus 5mm padding)
  Max Y: 217mm
```

### Content Placement Rules
1. All text must start at or after X = 20mm
2. All text must start at or after Y = 25mm
3. Text width must not exceed 170mm
4. Text must not extend beyond Y = 217mm (5mm above QR zone)

## Page Break Rules

### Automatic Page Breaks
The system must insert page breaks automatically when:

1. **Content Height Exceeds Available Space**
   - If the next content block would extend beyond Y = 217mm
   - If a paragraph would collide with the QR zone

2. **Table Overflow**
   - If a table row would extend beyond the safe area
   - Tables should split intelligently across pages

3. **Code Blocks**
   - If a code block would run beyond margins
   - Preserve readability during pagination

### Manual Page Breaks
Developers can insert manual page breaks for:
- Section separators
- Certification pages
- Document metadata pages

## Text Handling

### Word-Aware Wrapping
- Text must wrap at word boundaries
- No mid-word breaks unless absolutely necessary (very long words)
- Use `jsPDF.splitTextToSize()` with maximum width of 170mm

### Line Height
- Default line height: 1.15× font size
- Can be adjusted for specific sections but must remain consistent within sections

### Font Sizes
Standard font sizes (in points):
- **Title/Header**: 18-22pt
- **Section Headers**: 14-16pt
- **Body Text**: 10-12pt
- **Footer/Metadata**: 8-10pt

## Footer Placement

### Footer Zone
Footers must be placed above the QR code zone:
- **Y Position**: `222mm (QR zone start) - 5mm (padding) = 217mm`

### Footer Content
Typical footer elements:
- **Left**: Watermark text ("Verum Omnis patent Pending ✓")
- **Center**: Document metadata (hash, page numbers)
- **Right**: Additional metadata (placed left of QR code)

### Footer Spacing
- Footer text must maintain at least 5mm clearance from QR zone
- Footer text width must not exceed `145mm - 5mm = 140mm` to avoid QR zone

## Watermark Rules

### Placement
- Watermarks must be rendered as background layers
- Must not interfere with text readability
- Can span entire page but must remain behind text

### Opacity
- Watermarks should use reduced opacity (typically 10-20%)
- Must not obscure forensic seals or certification text

## QR Code Implementation

### Generation
```typescript
import QRCode from 'qrcode';

const qrCodeDataUrl = await QRCode.toDataURL(
  `VERUM-OMNIS-SEAL:${sealHash}`, 
  { 
    width: 200,  // High resolution for 45mm print size
    margin: 1    // Minimal margin
  }
);
```

### Rendering
QR codes must be:
1. Generated before PDF creation begins
2. Stored for reuse across all pages
3. Added to ALL pages using `addQRCodeToAllPages()` method
4. Rendered LAST after all other content

### Content
QR codes should encode:
- Forensic seal hash
- Case ID
- Document ID
- Timestamp (optional)

## Usage Examples

### Using PDFLayoutManager

```typescript
import { PDFLayoutManager } from '../utils/pdfLayout';
import QRCode from 'qrcode';

// Generate QR code
const qrData = await QRCode.toDataURL(documentId);

// Initialize layout manager
const layoutManager = new PDFLayoutManager();
const pdf = layoutManager.getPDF();

// Set QR code for all pages
layoutManager.setQRCode(qrData);

// Add content with automatic page breaks
layoutManager.addText("Title", { fontSize: 18 });
layoutManager.addSpacing(5);
layoutManager.addText("Body content...", { fontSize: 10 });

// Finalize - adds QR codes to all pages
layoutManager.finalize();

// Save
pdf.save('document.pdf');
```

### Manual Layout Control

```typescript
import {
  createVerumOmnisPDF,
  getSafeTextArea,
  addQRCodeToReservedZone,
  addFooterAboveQRZone,
  hasSpaceForContent
} from '../utils/pdfLayout';

const pdf = createVerumOmnisPDF();
const safeArea = getSafeTextArea();
let yPos = safeArea.y;

// Check if content fits
if (!hasSpaceForContent(yPos, 20)) {
  pdf.addPage();
  yPos = safeArea.y;
}

// Add footer on each page
addFooterAboveQRZone(pdf, leftText, centerText, rightText);

// Add QR code to current page
addQRCodeToReservedZone(pdf, qrCodeDataUrl);
```

## Validation Checklist

Before finalizing any PDF implementation, verify:

- [ ] Page size is A4 (210mm × 297mm)
- [ ] All margins are correctly implemented (25/20/20/30mm)
- [ ] QR code zone (45×45mm) is reserved on all pages
- [ ] No content overlaps with QR code zone
- [ ] Text wraps at word boundaries
- [ ] Page breaks occur automatically when needed
- [ ] Footers are placed above QR zone
- [ ] QR codes are rendered last on each page
- [ ] Watermarks don't obscure content
- [ ] All pages have QR codes in the reserved zone

## Forensic Compliance

These standards ensure:
- **Court Admissibility**: Proper margins for binding and handling
- **Chain of Custody**: QR codes on every page for verification
- **Professional Presentation**: Consistent formatting throughout
- **Print Safety**: No content near edges that could be cut off
- **Cryptographic Integrity**: QR codes contain verification data

## Maintenance

This layout system should be maintained as:
- **Single Source of Truth**: All PDF generation must use `utils/pdfLayout.ts`
- **Version Controlled**: Changes to layout standards require documentation updates
- **Tested**: Any changes should be validated with sample PDFs
- **Consistent**: Standards apply to all PDF outputs in the repository

## Support

For questions or issues with PDF layout implementation, refer to:
- Source code: `utils/pdfLayout.ts`
- Examples: `components/CaseManager.tsx`, `components/ChatMessage.tsx`
- This documentation: `docs/PDF_LAYOUT_STANDARDS.md`
